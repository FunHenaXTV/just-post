const post = {
  title: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞',
  body:
    '–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –≤ –ª—É—á—à–µ–π –Ω–∞ —Å–≤–µ—Ç–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ Just-Post. –í—Å–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –≤—ã–º—ã—à–ª–µ–Ω—ã –∏ —Å–ª—É—á–∞–π–Ω—ã.',
  likes: 77,
  reposts: 7,
}

// –ú–µ—Ç–æ–¥ posts –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise, –∏–º–∏—Ç–∏—Ä—É—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ
// –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º –∏ —Å–µ—Ä–≤–µ—Ä–æ–º (¬´–∑–∞–ø—Ä–æ—Å/–æ—Ç–≤–µ—Ç¬ª).
const server = {
  // –ê—Ä–≥—É–º–µ–Ω—Ç page ‚Äî –∫—É—Ä—Å–æ—Ä, –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∫–æ—Ç–æ—Ä—É—é –Ω–∞–¥–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å.
  // –° —ç—Ç–∏–º –Ω–æ–º–µ—Ä–æ–º –º—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫—É—é –ø–æ—Ä—Ü–∏—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.
  // –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –ø–æ—Ä—Ü–∏–∏ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –Ω–µ –±—É–¥—É—Ç, –Ω–æ –≤ –∂–∏–∑–Ω–∏
  // –∫—É—Ä—Å–æ—Ä –±—ã –≤–ª–∏—è–ª –Ω–∞ —Ç–æ, –∫–∞–∫–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Å—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä –±—ã –¥–æ—Å—Ç–∞–≤–∞–ª –∏–∑ –ë–î.
  posts(page = 1) {
    // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî 5-—è,
    // –º—ã —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è.
    const finished = page >= 5

    // –ò–Ω–∞—á–µ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫—É—Ä—Å–æ—Ä next.
    // –û–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—É–¥–µ—Ç –ø–æ —Å—á—ë—Ç—É —Å–ª–µ–¥—É—é—â–µ–π.
    // –¢–∞–∫ –∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å, —Å—Ç–æ–∏—Ç –ª–∏ –µ–º—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å
    // –∑–∞ –Ω–æ–≤–æ–π –ø–æ—Ä—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
    const next = finished ? null : page + 1

    // –í –∫–∞—á–µ—Å—Ç–≤–µ –ø–æ—Å—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –∏–∑ 5 –æ–±—ä–µ–∫—Ç–æ–≤ post.
    const posts = Array(5).fill(post)

    return new Promise((resolve) => {
      // –¢–∞–π–º–∞—É—Ç –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Å–µ—Ç–µ–≤—É—é ¬´–∑–∞–¥–µ—Ä–∂–∫—É¬ª.
      setTimeout(() => {
        resolve({ posts, next })
      }, 150)
    })
  },
}

const response = await server.posts()

function throttle(callee, timeout) {
  let timer = null

  return function perform(...args) {
    if (timer) return

    timer = setTimeout(() => {
      callee(...args)

      clearTimeout(timer)
      timer = null
    }, timeout)
  }
}

function appendPost(postData) {
  // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º:
  if (!postData) return

  // –•—Ä–∞–Ω–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç, –≤–Ω—É—Ç—Ä—å –∫–æ—Ç–æ—Ä–æ–≥–æ
  // –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã-—Å–≤–∏—Ç—ã:
  const main = document.querySelector('main')

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é composePost,
  // –∫–æ—Ç–æ—Ä—É—é –Ω–∞–ø–∏—à–µ–º —á—É—Ç—å –ø–æ–∑–∂–µ ‚Äî
  // –æ–Ω–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ HTML-—ç–ª–µ–º–µ–Ω—Ç:
  const postNode = composePost(postData)

  // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ main:
  main.append(postNode)
}


function composePost(postData) {
  // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º:
  if (!postData) return

  // –û–±—Ä–∞—â–∞–µ–º—Å—è –∫ —à–∞–±–ª–æ–Ω—É, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–ª–∏ —Ä–∞–Ω–µ–µ:
  const template = document.getElementById('post_template')

  // ...–∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.
  // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –±—É–¥–µ—Ç ¬´—Å–∫–µ–ª–µ—Ç¬ª —Å–≤–∏—Ç–∞, —ç–ª–µ–º–µ–Ω—Ç article.
  // –£–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –µ–≥–æ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å, –∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∞–º —ç–ª–µ–º–µ–Ω—Ç,
  // –∏–Ω–∞—á–µ –æ–Ω –∏–∑–º–µ–Ω–∏—Ç—Å—è —Å–∞–º, –∏ –º—ã –Ω–µ —Å–º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤–∏—Ç–æ–≤:
  const post = template.content.cloneNode(true)

  // –ò–∑ postData –ø–æ–ª—É—á–∞–µ–º –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
  const { title, body, likes, reposts } = postData

  // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ —á–∏—Å–ª–∞ –≤ –Ω—É–∂–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ ¬´—Å–∫–µ–ª–µ—Ç–µ¬ª:
  post.querySelector('h1').innerText = title
  post.querySelector('p').innerText = body
  post.querySelector('button:first-child').innerText += likes
  post.querySelector('button:last-child').innerText += reposts

  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç,
  // —á—Ç–æ–±—ã –µ–≥–æ –º–æ–∂–Ω–æ –±—ã–ª–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É:
  return post
}



async function fetchPosts() {
  // –ï—Å–ª–∏ –º—ã —É–∂–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å, –∏–ª–∏ –Ω–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è,
  // —Ç–æ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ –Ω–∞–¥–æ:
  if (isLoading || !shouldLoad) return

  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –ø–æ–∫–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è —ç—Ç–æ—Ç:
  isLoading = true

  const { posts, next } = await server.posts(nextPage)
  posts.forEach(appendPost)

  // –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –Ω–æ–º–µ—Ä–æ–º next:
  nextPage = next

  // –ï—Å–ª–∏ –º—ã —É–≤–∏–¥–µ–ª–∏, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è,
  // –æ—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –±–æ–ª—å—à–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–¥–æ:
  if (!next) shouldLoad = false

  // –ö–æ–≥–¥–∞ –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω,
  // —Å–Ω–∏–º–∞–µ–º —Ñ–ª–∞–≥ isLoading:
  isLoading = false
}



async function checkPosition() {
  // –ù–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞—Ç—å –≤—ã—Å–æ—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –≤—ã—Å–æ—Ç—É —ç–∫—Ä–∞–Ω–∞:
  const height = document.body.offsetHeight
  const screenHeight = window.innerHeight

  // –û–Ω–∏ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è: –µ—Å–ª–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞,
  // –≤—ã—Å–æ—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞ (–æ—Ç—Å—é–¥–∞ –∏ —Å–∫—Ä–æ–ª–ª).

  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –ø–∏–∫—Å–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø—Ä–æ—Å–∫—Ä–æ–ª–ª–∏–ª:
  const scrolled = window.scrollY

  // –û–±–æ–∑–Ω–∞—á–∏–º –ø–æ—Ä–æ–≥, –ø–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –∫–æ—Ç–æ—Ä–æ–º—É
  // –±—É–¥–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –∫–∞–∫–æ–µ-—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ.
  // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî —á–µ—Ç–≤–µ—Ä—Ç—å —ç–∫—Ä–∞–Ω–∞ –¥–æ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
  const threshold = height - screenHeight / 4

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∏–∑ —ç–∫—Ä–∞–Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
  const position = scrolled + screenHeight

  if (position >= threshold) {
    await fetchPosts()
  }
};(() => {
  window.addEventListener('scroll', throttle(checkPosition, 250))
  window.addEventListener('resize', throttle(checkPosition, 250))
})()

// –ö–∞–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ª–µ–¥—É—é—â–∞—è:
let nextPage = 2

// –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –∑–∞–ø—Ä–æ—Å, –Ω–æ –µ—â—ë –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç–≤–µ—Ç,
// –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –µ—â—ë –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å:
let isLoading = false

// –ï—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è, –≤–æ–æ–±—â–µ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ
// –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∏–∫–∞–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
let shouldLoad = true

function publishPost() {
  var text = document.getElementById('postInput').value;
  if (text.trim() !== '') {
    var post = document.createElement('div');
    post.className = 'post';
    post.innerHTML = '<h2>' + text + '</h2><footer><button type="button">‚ù§Ô∏è</button><button type="button">üîÑ</button></footer>';

    var newsFeed = document.querySelector('.news-feed');
    newsFeed.insertBefore(post, newsFeed.firstChild);

    document.getElementById('postInput').value = '';
  }
}